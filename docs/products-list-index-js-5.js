(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{10:function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var i=s(9);function n(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class a{constructor(t=[],{url:e="",sorted:s={id:t.find(t=>t.sortable).id,order:"asc"},isSortLocally:i=!1,step:a=20,start:r=0,end:l=r+a,clickableRow:o=!0}={}){n(this,"element",void 0),n(this,"subElements",{}),n(this,"data",[]),n(this,"loading",!1),n(this,"step",20),n(this,"start",1),n(this,"end",this.start+this.step),n(this,"onWindowScroll",async()=>{const{bottom:t}=this.element.getBoundingClientRect(),{id:e,order:s}=this.sorted;if(t<document.documentElement.clientHeight&&!this.loading&&!this.isSortLocally){this.start=this.end,this.end=this.start+this.step,this.loading=!0;const t=await this.loadData(e,s,this.start,this.end);this.update(t),this.loading=!1}}),n(this,"onSortClick",t=>{const e=t.target.closest('[data-sortable="true"]');if(e){const{id:t,order:s}=e.dataset,i=(t=>({asc:"desc",desc:"asc"}[t]))(s);this.sorted={id:t,order:i},e.dataset.order=i,e.append(this.subElements.arrow),this.isSortLocally?this.sortLocally(t,i):this.sortOnServer(t,i)}}),this.headersConfig=t,this.url=new URL(e,"https://course-js.javascript.ru"),this.sorted=s,this.isSortLocally=i,this.clickableRow=o,this.step=a,this.start=r,this.end=l,this.render()}async render(){const{id:t,order:e}=this.sorted,s=document.createElement("div");s.innerHTML=this.getTable();const i=s.firstElementChild;this.element=i,this.subElements=this.getSubElements(i);const n=await this.loadData(t,e,this.start,this.end);this.renderRows(n),this.initEventListeners()}async loadData(t,e,s=this.start,n=this.end){this.url.searchParams.set("_sort",t),this.url.searchParams.set("_order",e),this.url.searchParams.set("_start",s),this.url.searchParams.set("_end",n),this.element.classList.add("sortable-table_loading");const a=await Object(i.a)(this.url);return this.element.classList.remove("sortable-table_loading"),a}addRows(t){this.data=t,this.subElements.body.innerHTML=this.getTableRows(t)}update(t){const e=document.createElement("div");this.data=[...this.data,...t],e.innerHTML=this.getTableRows(t),this.subElements.body.append(...e.childNodes)}getTableHeader(){return`<div data-element="header" class="sortable-table__header sortable-table__row">\n      ${this.headersConfig.map(t=>this.getHeaderRow(t)).join("")}\n    </div>`}getHeaderRow({id:t,title:e,sortable:s}){return`\n      <div class="sortable-table__cell" data-id="${t}" data-sortable="${s}" data-order="${this.sorted.id===t?this.sorted.order:"asc"}">\n        <span>${e}</span>\n        ${this.getHeaderSortingArrow(t)}\n      </div>\n    `}getHeaderSortingArrow(t){return(this.sorted.id===t?this.sorted.order:"")?'<span data-element="arrow" class="sortable-table__sort-arrow">\n          <span class="sort-arrow"></span>\n        </span>':""}getTableBody(t){return`\n      <div data-element="body" class="sortable-table__body">\n        ${this.getTableRows(t)}\n      </div>`}getTableRows(t){return t.map(e=>this.clickableRow?`<a href="/products/${e.id}" class="sortable-table__row">\n          ${this.getTableRow(e,t)}\n        </a>`:`<div href="/products/${e.id}" class="sortable-table__row">\n          ${this.getTableRow(e,t)}\n        </div>`).join("")}getTableRow(t){return this.headersConfig.map(({id:t,template:e})=>({id:t,template:e})).map(({id:e,template:s})=>s?s(t[e]):`<div class="sortable-table__cell">${t[e]}</div>`).join("")}getTable(){return`\n      <div class="sortable-table">\n        ${this.getTableHeader()}\n        ${this.getTableBody(this.data)}\n\n        <div data-element="loading" class="loading-line sortable-table__loading-line"></div>\n\n        <div data-element="emptyPlaceholder" class="sortable-table__empty-placeholder">\n          No products\n        </div>\n      </div>`}initEventListeners(){this.subElements.header.addEventListener("pointerdown",this.onSortClick),document.addEventListener("scroll",this.onWindowScroll)}sortLocally(t,e){const s=this.sortData(t,e);this.subElements.body.innerHTML=this.getTableRows(s)}async sortOnServer(t,e){const s=1+this.step,i=await this.loadData(t,e,1,s);this.renderRows(i)}renderRows(t){t.length?(this.element.classList.remove("sortable-table_empty"),this.addRows(t)):this.element.classList.add("sortable-table_empty")}sortData(t,e){const s=[...this.data],i=this.headersConfig.find(e=>e.id===t),{sortType:n,customSorting:a}=i,r="asc"===e?1:-1;return s.sort((e,s)=>{switch(n){case"number":return r*(e[t]-s[t]);case"string":return r*e[t].localeCompare(s[t],"ru");case"custom":return r*a(e,s);default:return r*(e[t]-s[t])}})}getSubElements(t){return[...t.querySelectorAll("[data-element]")].reduce((t,e)=>(t[e.dataset.element]=e,t),{})}remove(){this.element.remove(),document.removeEventListener("scroll",this.onWindowScroll)}destroy(){this.remove(),this.subElements={}}}},7:function(t,e,s){"use strict";s.r(e),s.d(e,"default",(function(){return o}));var i=[{id:"images",title:"Image",sortable:!1,template:t=>{if(t.length>0)return`\n              <div class="sortable-table__cell">\n                <img class="sortable-table-image" alt="Image" src="${t[0].url}">\n              </div>\n            `}},{id:"title",title:"Name",sortable:!0,sortType:"string"},{id:"subcategory",title:"Category",sortable:!1,sortType:"string",template:t=>`<div class="sortable-table__cell">\n       <span data-tooltip='\n       <div class="sortable-table-tooltip">\n         <span class="sortable-table-tooltip__category">${t.category.title}</span> /\n         <b class="sortable-table-tooltip__subcategory">${t.title}</b>\n       </div>'>${t.title}</span>\n       </div>`},{id:"quantity",title:"Quantity",sortable:!0,sortType:"number"},{id:"price",title:"Price",sortable:!0,sortType:"number",template:t=>'<div class="sortable-table__cell">$'+t+"</div>"},{id:"status",title:"Status",sortable:!0,sortType:"number",template:t=>`<div class="sortable-table__cell">\n            ${t>0?"Active":"Inactive"}\n          </div>`}],n=s(10);function a(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class r{constructor({min:t=100,max:e=200,formatValue:s=(t=>"$"+t),selected:i={from:t,to:e}}={}){a(this,"element",void 0),a(this,"subElements",{}),a(this,"shiftX",void 0),a(this,"dragging",void 0),a(this,"clickDown",t=>{t.preventDefault();const e=t.target,{left:s,right:i}=e.getBoundingClientRect();e===this.subElements.thumbLeft?this.shiftX=i-t.clientX:this.shiftX=s-t.clientX,this.dragging=e,this.element.classList.add("range-slider_dragging"),document.addEventListener("pointermove",this.pointerMove),document.addEventListener("pointerup",this.clickUp)}),a(this,"pointerMove",t=>{t.preventDefault();const{left:e,right:s,width:i}=this.subElements.inner.getBoundingClientRect();if(this.dragging===this.subElements.thumbLeft){let s=(t.clientX-e+this.shiftX)/i;s<0&&(s=0),s*=100;let n=parseFloat(this.subElements.thumbRight.style.right);s+n>100&&(s=100-n),this.dragging.style.left=this.subElements.progress.style.left=s+"%",this.subElements.from.innerHTML=this.formatValue(this.getValue().from)}if(this.dragging===this.subElements.thumbRight){let e=(s-t.clientX-this.shiftX)/i;e<0&&(e=0),e*=100;let n=parseFloat(this.subElements.thumbLeft.style.left);n+e>100&&(e=100-n),this.dragging.style.right=this.subElements.progress.style.right=e+"%",this.subElements.to.innerHTML=this.formatValue(this.getValue().to)}}),a(this,"clickUp",t=>{this.element.classList.remove("range-slider_dragging"),document.removeEventListener("pointermove",this.pointerMove),document.removeEventListener("pointerup",this.clickUp),this.element.dispatchEvent(new CustomEvent("range-select",{detail:this.getValue(),bubbles:!0}))}),this.min=t,this.max=e,this.formatValue=s,this.selected=i,this.render()}get markup(){const{from:t,to:e}=this.selected;return`\n            <div class="range-slider">\n                <span data-element="from">${this.formatValue(t)}</span>\n                <div data-element="inner" class="range-slider__inner">\n                    <span data-element="progress" class="range-slider__progress"></span>\n                    <span data-element="thumbLeft" class="range-slider__thumb-left"></span>\n                    <span data-element="thumbRight" class="range-slider__thumb-right"></span>\n                </div>\n                <span data-element="to">${this.formatValue(e)}</span>\n            </div>`}render(){const t=document.createElement("div");t.innerHTML=this.markup,this.element=t.firstElementChild,this.subElements=this.getSubElements(this.element),this.initEventListeners(),this.update()}getSubElements(t){return[...t.querySelectorAll("[data-element]")].reduce((t,e)=>(t[e.dataset.element]=e,t),{})}initEventListeners(){const{thumbLeft:t,thumbRight:e}=this.subElements;t.addEventListener("pointerdown",this.clickDown),e.addEventListener("pointerdown",this.clickDown)}getValue(){const t=this.max-this.min,{left:e}=this.subElements.thumbLeft.style,{right:s}=this.subElements.thumbRight.style;return{from:Math.round(this.min+.01*parseFloat(e)*t),to:Math.round(this.max-.01*parseFloat(s)*t)}}remove(){this.element.remove()}destroy(){this.remove(),document.removeEventListener("pointermove",this.onThumbPointerMove),document.removeEventListener("pointerup",this.onThumbPointerUp)}update(){const t=this.max-this.min,e=Math.floor((this.selected.from-this.min)/t*100)+"%",s=Math.floor((this.max-this.selected.to)/t*100)+"%";this.subElements.progress.style.left=e,this.subElements.progress.style.right=s,this.subElements.thumbLeft.style.left=e,this.subElements.thumbRight.style.right=s}}function l(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class o{constructor(){l(this,"element",void 0),l(this,"subElements",{}),l(this,"components",{}),l(this,"filterData",{filterName:"",filterStatus:"",doubleSliderData:{from:0,to:0}}),l(this,"onFilterInput",t=>{const{filterName:e,filterStatus:s}=this.subElements,i=t.target;i===e?this.filterData.filterName=i.value.trim():i===s&&(this.filterData.filterStatus=i.value),this.updateTable()}),l(this,"onRangeSelect",t=>{const{from:e,to:s}=t.detail;this.filterData.doubleSliderData.from=e,this.filterData.doubleSliderData.to=s,this.updateTable()}),l(this,"clearFilters",()=>{const{filterName:t,filterStatus:e}=this.subElements,{min:s,max:i}=this.components.doubleSlider;t.value="",e.value="",this.filterData.filterName="",this.filterData.filterStatus="",this.components.doubleSlider.subElements.from.innerHTML="$"+s,this.components.doubleSlider.subElements.to.innerHTML="$"+i,this.components.doubleSlider.update(),this.filterData.doubleSliderData.from=0,this.filterData.doubleSliderData.to=4e3,this.updateTable()})}initComponents(){this.components.doubleSlider=new r({min:0,max:4e3}),this.filterData.doubleSliderData.from=this.components.doubleSlider.min,this.filterData.doubleSliderData.to=this.components.doubleSlider.max,this.components.sortableTable=new n.a(i,{url:"api/rest/products?_embed=subcategory.category"})}async render(){const t=document.createElement("div");return t.innerHTML=this.template,this.element=t.firstElementChild,this.subElements=this.getSubElements(this.element),this.initComponents(),await this.renderComponents(),this.initEventListeners(),this.element}get template(){return'\n    <div class="products-list">\n      <div class="content__top-panel">\n        <h1 class="page-title">Товары</h1>\n        <a href="/products/add" class="button-primary">Добавить товар</a>\n      </div>\n      <div class="content-box content-box_small">\n      <form data-element="filter" class="form-inline">\n          <div class="form-group">\n            <label class="form-label">Сортировать по:</label>\n            <input type="text" data-element="filterName" class="form-control" placeholder="Название товара">\n          </div>\n          <div class="form-group" data-element="sliderContainer">\n            <label class="form-label">Цена:</label>\n              \x3c!-- //! DoubleSlider --\x3e\n          </div>\n          <div class="form-group">\n            <label class="form-label">Статус:</label>\n            <select class="form-control" data-element="filterStatus">\n              <option value="" selected="">Любой</option>\n              <option value="1">Активный</option>\n              <option value="0">Неактивный</option>\n            </select>\n          </div>\n        </form>\n      </div>\n      <div data-element="productsContainer" class="products-list__container">\n        \x3c!--//! SortableTable--\x3e\n      </div>\n    </div>\n    '}initEventListeners(){const{filter:t}=this.subElements,{doubleSlider:e}=this.components;t.addEventListener("input",this.onFilterInput),e.element.addEventListener("range-select",this.onRangeSelect)}async updateTable(){const{sorted:t,step:e}=this.components.sortableTable,s=this.createURL();this.components.sortableTable.url.href=s,await this.components.sortableTable.sortOnServer(t.id,t.order,0,e)}createURL(){const{filterName:t,filterStatus:e,doubleSliderData:{from:s,to:i}}=this.filterData,n=new URL("api/rest/products?_embed=subcategory.category","https://course-js.javascript.ru/");return n.searchParams.set("price_gte",s),n.searchParams.set("price_lte",i),""!==t.trim()&&n.searchParams.set("title_like",t),""!=e&&n.searchParams.set("status",e),n.href}async renderComponents(){this.subElements.sliderContainer.append(this.components.doubleSlider.element),this.subElements.productsContainer.append(this.components.sortableTable.element)}getSubElements(t){return[...t.querySelectorAll("[data-element]")].reduce((t,e)=>(t[e.dataset.element]=e,t),{})}remove(){const{filter:t}=this.subElements;t.removeEventListener("input",this.onFilterInput),this.element=null}destroy(){this.remove();for(const t of Object.values(this.components))t.destroy()}}},9:function(t,e,s){"use strict";e.a=async function(t,e){let s,n;try{s=await fetch(t.toString(),e)}catch(t){throw new i(s,"Network error has occurred.")}if(!s.ok){let t=s.statusText;try{n=await s.json(),t=n.error&&n.error.message||n.data&&n.data.error&&n.data.error.message||t}catch(t){}let e=`Error ${s.status}: ${t}`;throw new i(s,n,e)}try{return await s.json()}catch(t){throw new i(s,null,t.message)}};class i extends Error{constructor(t,e,s){var i,n,a;super(s),a="FetchError",(n="name")in(i=this)?Object.defineProperty(i,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[n]=a,this.response=t,this.body=e}}window.addEventListener("unhandledrejection",t=>{t.reason instanceof i&&alert(t.reason.message)})}}]);
//# sourceMappingURL=products-list-index-js-5.js.map