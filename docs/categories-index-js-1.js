(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[,,,function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));var n=i(9),s=i(11),r=i(12);function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class a{constructor(){o(this,"element",void 0),o(this,"components",{}),o(this,"subElements",{}),o(this,"listContainers",{}),o(this,"reorderingEvent",async e=>{const t=e.target.childNodes,i=[...t].map(e=>({id:e.dataset.id,weight:[...t].indexOf(e)+1}));try{await Object(n.a)("https://course-js.javascript.ru/api/rest/subcategories",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),this.showNotificationMessage("Category order saved","success")}catch(e){this.showNotificationMessage("Category order NOT saved","error"),console.error("something went wrong",e)}}),o(this,"onPointerDown",e=>{if(e.target.closest(".category")&&!e.target.closest(".categories__sortable-list-item")){e.target.closest(".category").classList.toggle("category_open")}})}initEventListeners(){this.subElements.categoriesContainer.addEventListener("pointerdown",this.onPointerDown),document.addEventListener("sortable-list-reorder",this.reorderingEvent)}showNotificationMessage(e,t){const i=new s.a(e,{type:t});i.element.style.position="fixed",i.element.style.bottom="10px",i.element.style.right="10px",i.show()}async render(){const[e]=await Promise.all([this.getCategoriesData()]),t=document.createElement("div");return t.innerHTML=this.template,this.element=t.firstElementChild,this.subElements=this.getSubElements(this.element),this.createCategorieWrap(e),this.listContainers=this.getAllListsContainers(this.element),this.getCategoriesList(e),this.initEventListeners(),this.element}get template(){return'  \n        <div class="categories">\n        <div class="content__top-panel">\n          <h1 class="page-title">Categories</h1>\n        </div>\n        <div data-element="categoriesContainer">\n            \x3c!-- Render categories menue here --\x3e\n        </div>\n        </div>\n      '}async getCategoriesData(){const e=this.getRequestLink("/api/rest/categories");return await Object(n.a)(e)}getRequestLink(e){const t=new URL(e,"https://course-js.javascript.ru/");return t.searchParams.set("_sort","weight"),t.searchParams.set("_refs","subcategory"),t.href}createCategorieWrap(e=[]){const{categoriesContainer:t}=this.subElements,i=e.map(e=>`\n            <div class="category category_open" data-id="${e.id}">\n            <header class="category__header">\n                ${e.title}\n            </header>\n            <div class="category__body">\n                <div class="subcategory-list">\n                    <div class="sortable-list" data-element="listContainer" data-index="${e.id}">\n\n                    </div>\n                    </div>\n                    </div>\n                    </div>`).join("");t.innerHTML=i}getCategoriesList(e){e.forEach(e=>{const t=this.getCategoriesListItem(e),i=new r.a({items:t});this.components[e.id]=i,this.listContainers[e.id].append(i.element)})}getCategoriesListItem(e){const{subcategories:t}=e;return t.map(e=>{const t=document.createElement("div");return t.innerHTML=`\n        <li class="categories__sortable-list-item sortable-list__item" data-grab-handle="" data-id="${e.id}">\n            <strong>${e.title}</strong>\n            <span><b>${e.count}</b> products</span>\n        </li>`,t.firstElementChild})}getSubElements(e){return[...e.querySelectorAll("[data-element]")].reduce((e,t)=>(e[t.dataset.element]=t,e),{})}getAllListsContainers(e){return[...e.querySelectorAll("[data-index]")].reduce((e,t)=>(e[t.dataset.index]=t,e),{})}destroy(){const{categoriesContainer:e}=this.subElements;e.removeEventListener("pointerdown",this.onPointerDown);for(const e of Object.values(this.components))e.destroy()}}},,,,,,function(e,t,i){"use strict";t.a=async function(e,t){let i,s;try{i=await fetch(e.toString(),t)}catch(e){throw new n(i,"Network error has occurred.")}if(!i.ok){let e=i.statusText;try{s=await i.json(),e=s.error&&s.error.message||s.data&&s.data.error&&s.data.error.message||e}catch(e){}let t=`Error ${i.status}: ${e}`;throw new n(i,s,t)}try{return await i.json()}catch(e){throw new n(i,null,e.message)}};class n extends Error{constructor(e,t,i){var n,s,r;super(i),r="FetchError",(s="name")in(n=this)?Object.defineProperty(n,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[s]=r,this.response=e,this.body=t}}window.addEventListener("unhandledrejection",e=>{e.reason instanceof n&&alert(e.reason.message)})},,function(e,t,i){"use strict";function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,"a",(function(){return s}));class s{constructor(e="",{duration:t=0,type:i=""}={}){n(this,"timerId",void 0),this.message=e,this.duration=t,this.type=i,this.render()}get template(){return`<div class="notification ${this.type}" style="--value:${this.duration/1e3}s">\n                    <div class="timer"></div>\n                    <div class="inner-wrapper">\n                    <div class="notification-header">${"success"===this.type?"Успех!":"Ошибка"}</div>\n                    <div class="notification-body">\n                        ${this.message}\n                    </div>\n                    </div>\n                </div>`}render(){const e=document.createElement("div");e.innerHTML=this.template,this.element=e.firstChild}show(e=document.body){s.shownEl&&(s.shownEl.remove(),clearTimeout(this.timerId)),e.append(this.element),s.shownEl=this,this.timerId=setTimeout(()=>{this.destroy()},""+this.duration)}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null}}n(s,"shownEl",void 0)},function(e,t,i){"use strict";function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,"a",(function(){return s}));class s{constructor({items:e=[]}={}){n(this,"element",void 0),n(this,"onDocumentPointerMove",({clientX:e,clientY:t})=>{this.moveDraggingAt(e,t);const{firstElementChild:i,children:n}=this.element,{top:s}=i.getBoundingClientRect(),{bottom:r}=this.element.getBoundingClientRect();if(t<s)this.movePlaceholderAt(0);else if(t>r)this.movePlaceholderAt(n.length);else for(let e=0;e<n.length;e++){const i=n[e];if(i!==this.draggingElem){const{top:n,bottom:s}=i.getBoundingClientRect(),{offsetHeight:r}=i;if(t>n&&t<s){if(t<n+r/2){this.movePlaceholderAt(e);break}this.movePlaceholderAt(e+1);break}}}this.scrollIfCloseToWindowEdge(t)}),n(this,"onDocumentPointerUp",()=>{this.dragStop()}),this.items=e,this.render()}render(){this.element=document.createElement("ul"),this.element.className="sortable-list",this.addItems(),this.initEventListeners()}initEventListeners(){this.element.addEventListener("pointerdown",e=>this.onPointerDown(e))}addItems(){for(let e of this.items)e.classList.add("sortable-list__item");this.element.append(...this.items)}onPointerDown(e){if(1!==e.which)return!1;const t=e.target.closest(".sortable-list__item");t&&(e.target.closest("[data-grab-handle]")&&(e.preventDefault(),this.dragStart(t,e)),e.target.closest("[data-delete-handle]")&&(e.preventDefault(),t.remove()))}dragStart(e,{clientX:t,clientY:i}){this.elementInitialIndex=[...this.element.children].indexOf(e),this.pointerInitialShift={x:t-e.getBoundingClientRect().x,y:i-e.getBoundingClientRect().y},this.draggingElem=e,this.placeholderElem=document.createElement("li"),this.placeholderElem.className="sortable-list__placeholder",e.style.width=e.offsetWidth+"px",e.style.height=e.offsetHeight+"px",this.placeholderElem.style.width=e.style.width,this.placeholderElem.style.height=e.style.height,e.classList.add("sortable-list__item_dragging"),e.after(this.placeholderElem),this.element.append(e),this.moveDraggingAt(t,i),document.addEventListener("pointermove",this.onDocumentPointerMove),document.addEventListener("pointerup",this.onDocumentPointerUp)}moveDraggingAt(e,t){this.draggingElem.style.left=e-this.pointerInitialShift.x+"px",this.draggingElem.style.top=t-this.pointerInitialShift.y+"px"}scrollIfCloseToWindowEdge(e){e<20?window.scrollBy(0,-10):e>document.documentElement.clientHeight-20&&window.scrollBy(0,10)}movePlaceholderAt(e){const t=this.element.children[e];t!==this.placeholderElem&&this.element.insertBefore(this.placeholderElem,t)}dragStop(){const e=[...this.element.children].indexOf(this.placeholderElem);this.placeholderElem.replaceWith(this.draggingElem),this.draggingElem.classList.remove("sortable-list__item_dragging"),this.draggingElem.style.left="",this.draggingElem.style.top="",this.draggingElem.style.width="",this.draggingElem.style.height="",document.removeEventListener("pointermove",this.onDocumentPointerMove),document.removeEventListener("pointerup",this.onDocumentPointerUp),this.draggingElem=null,e!==this.elementInitialIndex&&this.element.dispatchEvent(new CustomEvent("sortable-list-reorder",{bubbles:!0,details:{from:this.elementInitialIndex,to:e}}))}remove(){this.element.remove(),document.removeEventListener("pointermove",this.onDocumentPointerMove),document.removeEventListener("pointerup",this.onDocumentPointerUp)}destroy(){this.remove()}}}]]);
//# sourceMappingURL=categories-index-js-1.js.map